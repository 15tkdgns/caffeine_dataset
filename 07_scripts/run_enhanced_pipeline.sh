#!/bin/bash
# 개선된 파이프라인 (Refer 피처 + 불균형 보정)
# 목표: 60%+ Accuracy

set -e

echo "======================================================================"
echo "개선된 시퀀스 예측 파이프라인"
echo "Refer 피처 반영 + 불균형 보정"
echo "======================================================================"
echo ""

PYTHON_CMD="./run_gpu.sh"

# 1단계: 개선된 전처리
echo "======================================================================"
echo "[1/2] 개선된 전처리 (Refer 피처 30+개)"
echo "======================================================================"
echo ""

python3 01_src/00_preprocessing/03_preprocess_enhanced.py

if [ $? -ne 0 ]; then
    echo "❌ 전처리 실패"
    exit 1
fi

echo ""
echo "✅ 전처리 완료"
echo ""

# 2단계: 개선된 그리드 서치
echo "======================================================================"
echo "[2/2] 개선된 그리드 서치 (불균형 보정)"
echo "======================================================================"
echo ""

${PYTHON_CMD} 01_src/01_training/05_enhanced_search.py

if [ $? -ne 0 ]; then
    echo "❌ 그리드 서치 실패"
    exit 1
fi

echo ""
echo "✅ 그리드 서치 완료"
echo ""

# 최종
echo "======================================================================"
echo "파이프라인 완료!"
echo "======================================================================"
echo ""
echo "📊 결과 비교:"
echo "  기존 모델: 49% Accuracy, 46.69% F1"
echo "  개선 모델: ???% (확인 필요)"
echo ""
echo "🎯 Refer 모델 목표: 63% Accuracy, 54.86% Macro F1"
echo ""
echo "����� 개선 사항:"
echo "  ✅ Refer 피처 추가 (15개 → 30+개)"
echo "  ✅ 불균형 보정 (sample_weight)"
echo "  ✅ Macro F1 최적화"
echo ""
