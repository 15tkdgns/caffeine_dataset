#!/bin/bash
# 시퀀스 예측 파이프라인
# X: 현재 카테고리 + 특성 → Y: 다음 카테고리

set -e

echo "======================================================================"
echo "시퀀스 예측 파이프라인 (현재 카테고리 → 다음 카테고리)"
echo "======================================================================"
echo ""

PYTHON_CMD="./run_gpu.sh"

# 1단계: 시퀀스 전처리
echo "======================================================================"
echo "[1/2] 시퀀스 전처리"
echo "======================================================================"
echo ""

python3 01_src/00_preprocessing/02_preprocess_sequence.py

if [ $? -ne 0 ]; then
    echo "❌ 전처리 실패"
    exit 1
fi

echo ""
echo "✅ 시퀀스 전처리 완료"
echo ""

# 2단계: GPU 그리드 서치
echo "======================================================================"
echo "[2/2] GPU 그리드 서치"
echo "======================================================================"
echo ""

${PYTHON_CMD} 01_src/01_training/04_sequence_search.py

if [ $? -ne 0 ]; then
    echo "❌ 그리드 서치 실패"
    exit 1
fi

echo ""
echo "✅ 그리드 서치 완료"
echo ""

# 최종
echo "======================================================================"
echo "파이프라인 완료!"
echo "======================================================================"
echo ""
echo "📊 결과:"
echo "  - 데이터: 02_data/01_processed/preprocessed_sequence.csv"
echo "  - 모델: 03_models/06_sequence/"
echo ""
echo "🎯 다음 단계:"
echo "  - metadata_*.json에서 성능 확인"
echo "  - 모델로 다음 구매 카테고리 예측"
echo ""
